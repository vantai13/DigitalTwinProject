<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Twin - Lu·ªìng Ho·∫°t ƒê·ªông (Updated)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00F7F7;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(0, 247, 247, 0.5);
        }
        
        .phase {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid #334155;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .phase-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00F7F7;
        }
        
        .phase-number {
            background: #00F7F7;
            color: #0f172a;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 20px;
            box-shadow: 0 0 20px rgba(0, 247, 247, 0.6);
        }
        
        .phase-title {
            font-size: 1.8em;
            color: #00F7F7;
            font-weight: 600;
        }
        
        .phase-time {
            margin-left: auto;
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            border: 1px solid #f97316;
        }
        
        .step {
            background: rgba(15, 23, 42, 0.6);
            border-left: 4px solid #00F7F7;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .step:hover {
            background: rgba(15, 23, 42, 0.9);
            transform: translateX(5px);
            box-shadow: 0 4px 16px rgba(0, 247, 247, 0.3);
        }
        
        .step-title {
            color: #00F7F7;
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 8px;
        }
        
        .step-desc {
            color: #94a3b8;
            margin-left: 20px;
        }
        
        .code {
            background: #0f172a;
            color: #00F7F7;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            border: 1px solid #334155;
        }
        
        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 20px 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #00F7F7 0%, #f97316 100%);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 25px;
        }
        
        .timeline-dot {
            position: absolute;
            left: -32px;
            width: 12px;
            height: 12px;
            background: #00F7F7;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 247, 247, 0.8);
        }
        
        .warning {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .info {
            background: rgba(34, 211, 238, 0.1);
            border-left: 4px solid #22d3ee;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .success {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .flow-diagram {
            background: rgba(15, 23, 42, 0.8);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            border: 2px solid #334155;
            text-align: center;
        }
        
        .flow-box {
            background: rgba(0, 247, 247, 0.1);
            border: 2px solid #00F7F7;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 8px;
            display: inline-block;
            min-width: 200px;
            box-shadow: 0 0 20px rgba(0, 247, 247, 0.2);
        }
        
        .arrow {
            color: #f97316;
            font-size: 2em;
            margin: 10px 0;
        }
        
        .frequency-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .frequency-table th,
        .frequency-table td {
            padding: 12px;
            border: 1px solid #334155;
            text-align: left;
        }
        
        .frequency-table th {
            background: rgba(0, 247, 247, 0.2);
            color: #00F7F7;
            font-weight: 600;
        }
        
        .frequency-table tr:hover {
            background: rgba(0, 247, 247, 0.1);
        }
        
        .highlight {
            color: #00F7F7;
            font-weight: 600;
        }
        
        .new-feature {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .new-feature h4 {
            color: #22c55e;
            margin-bottom: 10px;
        }
        
        .changed {
            background: rgba(249, 115, 22, 0.1);
            border-left: 4px solid #f97316;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ DIGITAL TWIN - LU·ªíNG HO·∫†T ƒê·ªòNG CHI TI·∫æT (C·∫¨P NH·∫¨T M·ªöI NH·∫§T)</h1>
        
        <!-- PHASE 0: STARTUP -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">0</div>
                <div class="phase-title">KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG</div>
                <div class="phase-time">‚è±Ô∏è 0-5s</div>
            </div>
            
            <div class="step">
                <div class="step-title">üì¶ 1. Backend Flask (run.py)</div>
                <div class="step-desc">
                    ‚Ä¢ File: <span class="code">backend/run.py</span><br>
                    ‚Ä¢ Load <span class="code">.env</span> ‚Üí ƒê·ªçc c·∫•u h√¨nh (PORT, HOST, DEBUG)<br>
                    ‚Ä¢ G·ªçi <span class="code">create_app()</span> ‚Üí Kh·ªüi t·∫°o Flask app<br>
                    ‚Ä¢ <strong>C·∫•u h√¨nh SocketIO:</strong> <span class="code">async_mode='threading'</span> (thay v√¨ eventlet)<br>
                    ‚Ä¢ Kh·ªüi ƒë·ªông SocketIO Server t·∫°i <span class="code">localhost:5000</span><br>
                    ‚Ä¢ <strong>Kh·ªüi ƒë·ªông Monitoring Service:</strong> <span class="code">start_monitoring_service()</span>
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üåê 2. Mininet Simulation (main.py)</div>
                <div class="step-desc">
                    ‚Ä¢ File: <span class="code">mininet_twin/main.py</span><br>
                    ‚Ä¢ ƒê·ªçc <span class="code">topology.json</span> ‚Üí T·∫°o m·∫°ng ·∫£o<br>
                    ‚Ä¢ Kh·ªüi t·∫°o <span class="code">Mininet</span> v·ªõi <span class="code">CPULimitedHost, OVSKernelSwitch, TCLink</span><br>
                    ‚Ä¢ <strong class="highlight">QUAN TR·ªåNG:</strong> G√°n <span class="code">threading.Lock()</span> cho m·ªói host ƒë·ªÉ tr√°nh race condition<br>
                    ‚Ä¢ G·ªçi <span class="code">net.start()</span> ‚Üí M·∫°ng Mininet ho·∫°t ƒë·ªông
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üíª 3. Frontend Vue.js (App.vue)</div>
                <div class="step-desc">
                    ‚Ä¢ File: <span class="code">frontend/src/App.vue</span><br>
                    ‚Ä¢ <span class="code">onMounted()</span> ‚Üí G·ªçi <span class="code">checkBackendHealth()</span><br>
                    ‚Ä¢ <span class="code">setupWebSocket()</span> ‚Üí K·∫øt n·ªëi Socket v·ªõi <span class="code">reconnection=true</span><br>
                    ‚Ä¢ ƒê·ª£i nh·∫≠n <span class="code">initial_state</span> event
                </div>
            </div>
            
            <div class="new-feature">
                <h4>‚ú® T√çNH NƒÇNG M·ªöI: Multi-View Support</h4>
                ‚Ä¢ Component <span class="code">ViewSwitcher.vue</span> cho ph√©p chuy·ªÉn ƒë·ªïi gi·ªØa:<br>
                &nbsp;&nbsp;‚Üí <strong>Live Monitoring:</strong> Xem topology real-time<br>
                &nbsp;&nbsp;‚Üí <strong>Analytics Dashboard:</strong> Xem bi·ªÉu ƒë·ªì Grafana<br>
                ‚Ä¢ Component <span class="code">AnalyticsView.vue</span> t√≠ch h·ª£p Grafana iframe
            </div>
        </div>

        <!-- PHASE 1: INITIALIZATION -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">1</div>
                <div class="phase-title">KH·ªûI T·∫†O TOPOLOGY</div>
                <div class="phase-time">‚è±Ô∏è 5-8s</div>
            </div>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üì° Mininet ‚Üí Backend</div>
                    <div class="step-desc">
                        ‚Ä¢ G·ªçi <span class="code">api_client.push_topology(net)</span><br>
                        ‚Ä¢ POST <span class="code">/api/init/topology</span><br>
                        ‚Ä¢ Payload: hosts[], switches[], links[] (v·ªõi bandwidth capacity t·ª´ TCLink)
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üß† Backend x·ª≠ l√Ω</div>
                    <div class="step-desc">
                        ‚Ä¢ File: <span class="code">backend/app/api/topology.py</span><br>
                        ‚Ä¢ <span class="code">init_topology()</span> ‚Üí X√≥a d·ªØ li·ªáu c≈©<br>
                        ‚Ä¢ T·∫°o c√°c ƒë·ªëi t∆∞·ª£ng Host, Switch, Link trong <span class="code">digital_twin</span><br>
                        ‚Ä¢ <strong>Kh·ªüi t·∫°o InfluxDB Writer Queue:</strong> <span class="code">telemetry_queue</span><br>
                        ‚Ä¢ Emit <span class="code">initial_state</span> qua WebSocket
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üé® Frontend nh·∫≠n d·ªØ li·ªáu</div>
                    <div class="step-desc">
                        ‚Ä¢ Socket event: <span class="code">initial_state</span><br>
                        ‚Ä¢ <strong class="highlight">FIX M·ªöI:</strong> X·ª≠ l√Ω status offline/down ngay t·ª´ initial state<br>
                        ‚Ä¢ Set ƒë√∫ng group cho nodes (host-offline, switch-offline)<br>
                        ‚Ä¢ Set label='DOWN' cho links c√≥ status down<br>
                        ‚Ä¢ <span class="code">networkData.value = data</span><br>
                        ‚Ä¢ <span class="code">TopologyView.vue</span> ‚Üí V·∫Ω s∆° ƒë·ªì vis-network
                    </div>
                </div>
            </div>
        </div>

        <!-- PHASE 2: TRAFFIC GENERATION -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">2</div>
                <div class="phase-title">SINH TRAFFIC & MONITORING</div>
                <div class="phase-time">‚è±Ô∏è 8s ‚Üí V√¥ h·∫°n</div>
            </div>
            
            <div class="step">
                <div class="step-title">üö¶ A. Traffic Generator Start</div>
                <div class="step-desc">
                    ‚Ä¢ File: <span class="code">mininet_twin/traffic/generator.py</span><br>
                    ‚Ä¢ <span class="code">traffic_gen.start()</span> ‚Üí Kh·ªüi ƒë·ªông thread daemon<br>
                    ‚Ä¢ <span class="code">_start_servers()</span> ‚Üí Kill iperf c≈©, ch·∫°y <span class="code">iperf -s -u &</span><br>
                    ‚Ä¢ <span class="code">_traffic_loop()</span> ‚Üí V√≤ng l·∫∑p v√¥ h·∫°n
                </div>
            </div>
            
            <div class="changed">
                <strong>‚ö†Ô∏è THAY ƒê·ªîI QUAN TR·ªåNG - LOCK MECHANISM:</strong><br>
                ‚Ä¢ Tr∆∞·ªõc khi g·ª≠i l·ªánh iperf, ki·ªÉm tra <span class="code">hasattr(src, 'lock')</span><br>
                ‚Ä¢ N·∫øu c√≥ lock ‚Üí <span class="code">with src.lock:</span> ƒë·ªÉ tr√°nh xung ƒë·ªôt<br>
                ‚Ä¢ Ki·ªÉm tra <span class="code">src.shell</span> v√† <span class="code">src.waiting</span> tr∆∞·ªõc khi th·ª±c thi<br>
                ‚Ä¢ Try-catch bao quanh m·ªçi l·ªánh cmd ƒë·ªÉ tr√°nh crash
            </div>
            
            <div class="info">
                <strong>üîÅ Traffic Loop (Ch·∫°y li√™n t·ª•c):</strong><br>
                ‚Ä¢ Random ch·ªçn 2 host kh√°c nhau: <span class="code">random.sample(net.hosts, 2)</span><br>
                ‚Ä¢ Random bandwidth t·ª´ list: [5, 10, 20, 50, 80, 120] Mbps<br>
                ‚Ä¢ Random duration: 2-5 gi√¢y<br>
                ‚Ä¢ L·ªánh: <span class="code">iperf -c {dst.IP()} -u -b {bw}M -t {duration} &</span><br>
                ‚Ä¢ Sleep: 0.5-2s gi·ªØa c√°c l·∫ßn t·∫°o traffic
            </div>
            
            <div class="step">
                <div class="step-title">üîç B. Background Latency Measurement</div>
                <div class="step-desc">
                    ‚Ä¢ File: <span class="code">mininet_twin/collectors/network_stats.py</span><br>
                    ‚Ä¢ <span class="code">start_background_measurement(net)</span> ‚Üí Thread daemon ri√™ng<br>
                    ‚Ä¢ Ch·∫°y <span class="code">_measurement_loop()</span><br>
                    ‚Ä¢ <strong class="highlight">RANDOM SAMPLING:</strong> Random ch·ªçn MAX_SAMPLES_PER_CYCLE (10) c·∫∑p host<br>
                    ‚Ä¢ Ping v·ªõi <span class="code">-c 1 -W 0.1</span> (1 packet, timeout 0.1s)<br>
                    ‚Ä¢ Parse latency, loss, jitter (mdev) t·ª´ output<br>
                    ‚Ä¢ <strong>D√πng Lock khi ping:</strong> <span class="code">with h_src.lock:</span><br>
                    ‚Ä¢ L∆∞u v√†o <span class="code">_metrics_cache</span> (thread-safe v·ªõi <span class="code">_cache_lock</span>)<br>
                    ‚Ä¢ Interval: 1 gi√¢y
                </div>
            </div>
        </div>

        <!-- PHASE 3: DATA COLLECTION -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">3</div>
                <div class="phase-title">THU TH·∫¨P D·ªÆ LI·ªÜU (Main Loop)</div>
                <div class="phase-time">‚è±Ô∏è M·ªói 1 gi√¢y</div>
            </div>
            
            <div class="warning">
                <strong>‚ö†Ô∏è V√íNG L·∫∂P CH√çNH - QUAN TR·ªåNG NH·∫§T:</strong><br>
                File: <span class="code">mininet_twin/main.py</span> ‚Üí H√†m <span class="code">run_simulation()</span><br>
                Loop v√¥ h·∫°n ch·∫°y m·ªói <span class="code">SYNC_INTERVAL</span> (m·∫∑c ƒë·ªãnh 1s)<br>
                <strong class="highlight">WARM-UP:</strong> Sleep 3s sau khi start traffic ƒë·ªÉ h·ªá th·ªëng ·ªïn ƒë·ªãnh
            </div>
            
            <div class="changed">
                <strong>üî• THAY ƒê·ªîI: T√≠nh Real Interval</strong><br>
                ‚Ä¢ D√πng <span class="code">time.monotonic()</span> thay v√¨ sleep c·ªë ƒë·ªãnh<br>
                ‚Ä¢ T√≠nh <span class="code">real_interval = current_time - last_check_time</span><br>
                ‚Ä¢ Tr√°nh l·ªói chia cho 0: <span class="code">if real_interval < 0.001: real_interval = 0.001</span><br>
                ‚Ä¢ ƒê·∫£m b·∫£o t√≠nh to√°n throughput ch√≠nh x√°c h∆°n
            </div>
            
            <table class="frequency-table">
                <thead>
                    <tr>
                        <th>Thao t√°c</th>
                        <th>File / H√†m</th>
                        <th>T·∫ßn su·∫•t</th>
                        <th>C·∫£i ti·∫øn m·ªõi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="highlight">1. Thu th·∫≠p CPU</td>
                        <td><span class="code">collectors/host_stats.py</span><br>
                            <span class="code">get_host_cpu_usage()</span>
                        </td>
                        <td class="highlight">M·ªói 1s</td>
                        <td>
                            <strong>Cgroups-based measurement:</strong><br>
                            ‚Ä¢ ƒê·ªçc <span class="code">/sys/fs/cgroup/cpuacct.usage</span><br>
                            ‚Ä¢ T√≠nh delta CPU usage d·ª±a tr√™n nanoseconds<br>
                            ‚Ä¢ Fallback: D√πng <span class="code">ps -p {pid}</span> n·∫øu kh√¥ng c√≥ cgroup<br>
                            ‚Ä¢ Cache gi√° tr·ªã c≈© trong <span class="code">_cpu_tracker</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="highlight">2. Thu th·∫≠p Memory</td>
                        <td><span class="code">get_host_memory_usage()</span></td>
                        <td class="highlight">M·ªói 1s</td>
                        <td>
                            ‚Ä¢ Ch·∫°y <span class="code">free -m</span><br>
                            ‚Ä¢ Parse output v·ªõi regex: <span class="code">re.findall(r'\d+', line)</span><br>
                            ‚Ä¢ T√≠nh % th·ª±c: <span class="code">(used/total) * 100</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="highlight">3. Thu th·∫≠p Link Bandwidth</td>
                        <td><span class="code">collectors/link_stats.py</span><br>
                            <span class="code">collect_link_metrics()</span>
                        </td>
                        <td class="highlight">M·ªói 1s</td>
                        <td>
                            <strong>Exponential Moving Average (EMA):</strong><br>
                            ‚Ä¢ ALPHA = 0.7 (70% gi√° tr·ªã m·ªõi, 30% gi√° tr·ªã c≈©)<br>
                            ‚Ä¢ <span class="code">smoothed = current*0.7 + old*0.3</span><br>
                            ‚Ä¢ Gi·∫£m nhi·ªÖu (noise), tr√°nh s·ªë li·ªáu nh·∫£y lung tung<br>
                            ‚Ä¢ <strong>Timeout protection:</strong> <span class="code">timeout 0.2s cat /proc/net/dev</span><br>
                            ‚Ä¢ D√πng Lock khi ƒë·ªçc: <span class="code">with node.lock:</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="highlight">4. Thu th·∫≠p Switch Stats</td>
                        <td><span class="code">collectors/switch_stats.py</span><br>
                            <span class="code">collect_switch_port_stats()</span>
                        </td>
                        <td class="highlight">M·ªói 5s</td>
                        <td>
                            ‚Ä¢ <strong>Caching:</strong> Ch·ªâ g·ªçi l·∫°i sau 5s (gi·∫£m overhead)<br>
                            ‚Ä¢ Ch·∫°y <span class="code">ovs-ofctl dump-ports {switch}</span><br>
                            ‚Ä¢ Parse RX/TX packets, bytes, dropped, errors<br>
                            ‚Ä¢ L∆∞u full metadata: switch_name, port_name
                        </td>
                    </tr>
                    <tr>
                        <td class="highlight">5. L·∫•y Latency/Loss</td>
                        <td><span class="code">collectors/network_stats.py</span><br>
                            <span class="code">measure_path_metrics()</span>
                        </td>
                        <td class="highlight">Instant</td>
                        <td>
                            ‚Ä¢ ƒê·ªçc t·ª´ <span class="code">_metrics_cache.copy()</span><br>
                            ‚Ä¢ KH√îNG ch·ªù Ping (background thread ƒë√£ l√†m)<br>
                            ‚Ä¢ Return ngay l·∫≠p t·ª©c (non-blocking)
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div class="step">
                <div class="step-title">üì¶ T·∫°o Telemetry Batch</div>
                <div class="step-desc">
                    ‚Ä¢ T·ªïng h·ª£p t·∫•t c·∫£ d·ªØ li·ªáu v√†o 1 dictionary:<br>
                    <span class="code">
                    telemetry_batch = {<br>
                    &nbsp;&nbsp;"timestamp": time.time(),<br>
                    &nbsp;&nbsp;"hosts": [{"name", "cpu", "mem"}, ...],<br>
                    &nbsp;&nbsp;"links": [{"id", "bw"}, ...],<br>
                    &nbsp;&nbsp;"switches": [{"name", "ports": {...}}, ...],<br>
                    &nbsp;&nbsp;"latency": [{"pair", "latency", "loss", "jitter"}, ...]<br>
                    }
                    </span>
                </div>
            </div>
        </div>

        <!-- PHASE 4: DATA TRANSMISSION -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">4</div>
                <div class="phase-title">TRUY·ªÄN D·ªÆ LI·ªÜU ‚Üí BACKEND</div>
                <div class="phase-time">‚è±Ô∏è M·ªói 1 gi√¢y</div>
            </div>
            
            <div class="flow-diagram">
                <div class="flow-box">Mininet<br><span class="code">socket_client.send_telemetry()</span></div>
                <div class="arrow">‚¨áÔ∏è</div>
                <div class="flow-box">WebSocket Emit<br><span class="code">mininet_telemetry</span></div>
                <div class="arrow">‚¨áÔ∏è</div>
                <div class="flow-box">Backend SocketIO<br><span class="code">handle_mininet_telemetry()</span></div>
            </div>
            
            <div class="step">
                <div class="step-title">üß† Backend x·ª≠ l√Ω Batch</div>
                <div class="step-desc">
                    ‚Ä¢ File: <span class="code">backend/app/events/socket_events.py</span><br>
                    ‚Ä¢ Event: <span class="code">@socketio.on('mininet_telemetry')</span><br><br>
                    
                    <strong>A. Ghi v√†o InfluxDB (Background Worker):</strong><br>
                    ‚Ä¢ Push v√†o <span class="code">telemetry_queue</span> (Queue v·ªõi maxsize=100)<br>
                    ‚Ä¢ <strong class="highlight">Queue Full Protection:</strong> Timeout 0.1s, drop data n·∫øu ƒë·∫ßy<br>
                    ‚Ä¢ Worker thread t·ª± ƒë·ªông ghi ‚Üí Non-blocking<br>
                    ‚Ä¢ <strong>Error handling:</strong> ƒê·∫øm l·ªói li√™n ti·∫øp, sleep 10s n·∫øu > 10 l·ªói<br>
                    ‚Ä¢ Log queue size n·∫øu > 50% capacity<br><br>
                    
                    <strong>B. C·∫≠p nh·∫≠t Digital Twin (v·ªõi Lock):</strong><br>
                    ‚Ä¢ <span class="code">with data_lock:</span> (critical section)<br>
                    ‚Ä¢ <strong>Hosts:</strong><br>
                    &nbsp;&nbsp;‚Üí Set status='up' n·∫øu nh·∫≠n ƒë∆∞·ª£c data (was_offline tracking)<br>
                    &nbsp;&nbsp;‚Üí Update CPU, Memory v·ªõi timestamp t·ª´ batch<br>
                    &nbsp;&nbsp;‚Üí Broadcast <span class="code">host_updated</span> n·∫øu status thay ƒë·ªïi<br>
                    ‚Ä¢ <strong>Links:</strong><br>
                    &nbsp;&nbsp;‚Üí <span class="code">previous_status = link.status</span> (l∆∞u tr∆∞·ªõc khi update)<br>
                    &nbsp;&nbsp;‚Üí G·ªçi <span class="code">update_performance_metrics()</span><br>
                    &nbsp;&nbsp;‚Üí <strong class="highlight">Detection:</strong> N·∫øu status thay ƒë·ªïi ‚Üí Broadcast ngay<br>
                    &nbsp;&nbsp;‚Üí X·ª≠ l√Ω throughput <= 0.1 Mbps ‚Üí Force status='down'<br>
                    ‚Ä¢ <strong>Switches:</strong><br>
                    &nbsp;&nbsp;‚Üí G·ªçi <span class="code">heartbeat(timestamp)</span><br>
                    &nbsp;&nbsp;‚Üí Update <span class="code">port_stats</span> n·∫øu c√≥<br>
                    ‚Ä¢ <strong>Latency:</strong><br>
                    &nbsp;&nbsp;‚Üí L∆∞u v√†o <span class="code">digital_twin.update_path_metrics()</span><br><br>
                    
                    <strong>C. Broadcast cho Frontend:</strong><br>
                    ‚Ä¢ T·∫°o <span class="code">frontend_data</span> t·ª´ Digital Twin state<br>
                    ‚Ä¢ Include status t·ª´ Backend (not raw Mininet data)<br>
                    ‚Ä¢ <span class="code">socketio.emit('network_batch_update', frontend_data)</span>
                </div>
            </div>
            
            <div class="new-feature">
                <h4>‚ú® T√çNH NƒÇNG M·ªöI: InfluxDB Background Writer</h4>
                ‚Ä¢ File: <span class="code">backend/app/services/influx_service.py</span><br>
                ‚Ä¢ Batch size: 500 points ho·∫∑c flush m·ªói 1s<br>
                ‚Ä¢ Ghi 3 measurements:<br>
                &nbsp;&nbsp;‚Üí <strong>host_metrics:</strong> cpu_usage, memory_usage (tag: host_name)<br>
                &nbsp;&nbsp;‚Üí <strong>link_metrics:</strong> throughput_mbps, packet_loss_percent (tags: link_id, src_node, dst_node)<br>
                &nbsp;&nbsp;‚Üí <strong>path_metrics:</strong> latency_ms, packet_loss_percent, jitter_ms (tag: pair_id)<br>
                ‚Ä¢ Timestamp precision: nanoseconds<br>
                ‚Ä¢ Write Options: retry_interval=5000ms
            </div>
        </div>

        <!-- PHASE 5: FRONTEND UPDATE -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">5</div>
                <div class="phase-title">C·∫¨P NH·∫¨T GIAO DI·ªÜN</div>
                <div class="phase-time">‚è±Ô∏è M·ªói 1 gi√¢y</div>
            </div>
            
            <div class="step">
                <div class="step-title">üì° Frontend nh·∫≠n WebSocket</div>
                <div class="step-desc">
                    ‚Ä¢ File: <span class="code">frontend/src/App.vue</span><br>
                    ‚Ä¢ Event: <span class="code">socket.on('network_batch_update', (batchData) => {...})</span><br>
                    ‚Ä¢ Ki·ªÉm tra <span class="code">networkData.value</span> ƒë√£ kh·ªüi t·∫°o ch∆∞a
                </div>
            </div>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üîÑ C·∫≠p nh·∫≠t Hosts</div>
                    <div class="step-desc">
                        ‚Ä¢ Duy·ªát <span class="code">batchData.hosts</span><br>
                        ‚Ä¢ T√¨m node trong <span class="code">networkData.value.graph_data.nodes</span><br>
                        ‚Ä¢ <strong class="highlight">Validation:</strong> Ki·ªÉm tra node kh√¥ng b·ªã g√°n nh·∫ßm group<br>
                        ‚Ä¢ Merge d·ªØ li·ªáu: <span class="code">node.details = {...node.details, cpu, mem, status}</span><br>
                        ‚Ä¢ L·∫•y status tr·ª±c ti·∫øp t·ª´ backend (kh√¥ng t√≠nh to√°n l·∫°i)<br>
                        ‚Ä¢ Logic group:<br>
                        &nbsp;&nbsp;‚Üí <span class="code">status === 'high-load'</span> ‚Üí 'host-high-load'<br>
                        &nbsp;&nbsp;‚Üí <span class="code">status === 'offline'</span> ‚Üí 'host-offline'<br>
                        &nbsp;&nbsp;‚Üí Else ‚Üí 'host'
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üîó C·∫≠p nh·∫≠t Links</div>
                    <div class="step-desc">
                        ‚Ä¢ Duy·ªát <span class="code">batchData.links</span><br>
                        ‚Ä¢ T√¨m edge trong <span class="code">graph_data.edges</span><br>
                        ‚Ä¢ L·∫•y <span class="code">bandwidth_capacity</span> t·ª´ edge.details<br>
                        ‚Ä¢ <strong class="highlight">FIX QUAN TR·ªåNG:</strong> Ki·ªÉm tra throughput <= 0.1 Mbps<br>
                        ‚Ä¢ N·∫øu throughput = 0 ‚Üí Force:<br>
                        &nbsp;&nbsp;‚Üí <span class="code">edge.label = 'DOWN'</span><br>
                        &nbsp;&nbsp;‚Üí <span class="code">edge.utilization = 0</span><br>
                        &nbsp;&nbsp;‚Üí <span class="code">edge.status = 'down'</span><br>
                        ‚Ä¢ N·∫øu throughput > 0:<br>
                        &nbsp;&nbsp;‚Üí T√≠nh utilization: <span class="code">(bw / capacity) * 100</span><br>
                        &nbsp;&nbsp;‚Üí <span class="code">edge.label = `${bw.toFixed(1)} Mbps`</span><br>
                        &nbsp;&nbsp;‚Üí <strong>L·∫•y status t·ª´ Backend:</strong> <span class="code">edge.status = lData.status</span><br>
                        ‚Ä¢ Update <span class="code">edge.details.status</span> ƒë·ªìng b·ªô
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üñ•Ô∏è C·∫≠p nh·∫≠t Switches</div>
                    <div class="step-desc">
                        ‚Ä¢ Duy·ªát <span class="code">batchData.switches</span><br>
                        ‚Ä¢ T√¨m node trong graph_data.nodes<br>
                        ‚Ä¢ Heartbeat nh·∫≠n ƒë∆∞·ª£c ‚Üí <span class="code">node.details.status = 'up'</span><br>
                        ‚Ä¢ Reset group v·ªÅ 'switch' (n·∫øu tr∆∞·ªõc ƒë√≥ offline)
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üé® Re-render vis-network</div>
                    <div class="step-desc">
                        ‚Ä¢ File: <span class="code">frontend/src/components/TopologyView.vue</span><br>
                        ‚Ä¢ <span class="code">watch(graphDataString, ...)</span> trigger<br>
                        ‚Ä¢ G·ªçi <span class="code">processNodes()</span> v√† <span class="code">processEdges()</span><br>
                        ‚Ä¢ <span class="code">networkInstance.value.body.data.nodes.update(processedNodes)</span><br>
                        ‚Ä¢ <span class="code">networkInstance.value.body.data.edges.update(processedEdges)</span><br>
                        ‚Ä¢ S∆° ƒë·ªì t·ª± ƒë·ªông c·∫≠p nh·∫≠t m√†u/label/shadow m√† kh√¥ng reload page
                    </div>
                </div>
            </div>
            
            <div class="new-feature">
                <h4>‚ú® C·∫¢I TI·∫æN: Edge Processing Logic</h4>
                ‚Ä¢ File: <span class="code">TopologyView.vue</span> ‚Üí <span class="code">processEdges()</span><br>
                ‚Ä¢ <strong>∆Øu ti√™n x·ª≠ l√Ω theo status:</strong><br>
                1. Status = 'down' ho·∫∑c 'offline' ‚Üí Gray, dashed, label='DOWN'<br>
                2. Throughput <= 0.1 Mbps ‚Üí Force DOWN (override status)<br>
                3. Status = 'high-load' ‚Üí Red (#F60000), width=4, shadow red<br>
                4. Status = 'warning' ‚Üí Orange (#f97316), width=3.5, shadow orange<br>
                5. Status = 'up' ‚Üí Cyan (#00F7F7), width=2.5, shadow if utilization > 0<br>
                ‚Ä¢ <strong>Font config:</strong> strokeWidth=3, strokeColor=#0f172a (readability)
            </div>
            
            <div class="changed">
                <strong>üî• FIX: Node Group Detection</strong><br>
                ‚Ä¢ File: <span class="code">TopologyView.vue</span> ‚Üí <span class="code">processNodes()</span><br>
                ‚Ä¢ <strong>Root Cause:</strong> Node group b·ªã g√°n nh·∫ßm do ƒë·ªçc t·ª´ <span class="code">node.group</span> c≈©<br>
                ‚Ä¢ <strong>Solution:</strong><br>
                &nbsp;&nbsp;‚Üí X√°c ƒë·ªãnh lo·∫°i node t·ª´ ID: <span class="code">isHost = node.id.startsWith('h')</span><br>
                &nbsp;&nbsp;‚Üí X√°c ƒë·ªãnh lo·∫°i node t·ª´ ID: <span class="code">isSwitch = node.id.startsWith('s')</span><br>
                &nbsp;&nbsp;‚Üí G√°n group d·ª±a tr√™n (isHost/isSwitch) + status, KH√îNG d√πng node.group c≈©<br>
                ‚Ä¢ <strong>Groups:</strong><br>
                &nbsp;&nbsp;‚Üí Host: 'host', 'host-offline', 'host-high-load'<br>
                &nbsp;&nbsp;‚Üí Switch: 'switch', 'switch-offline', 'switch-high-load'
            </div>
        </div>

        <!-- PHASE 6: REAPER THREAD -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">6</div>
                <div class="phase-title">GI√ÅM S√ÅT TIMEOUT (Reaper Thread)</div>
                <div class="phase-time">‚è±Ô∏è M·ªói 3 gi√¢y</div>
            </div>
            
            <div class="warning">
                <strong>‚ö†Ô∏è THREAD ƒê·ªòC L·∫¨P - QUAN TR·ªåNG:</strong><br>
                File: <span class="code">backend/app/services/monitor_service.py</span><br>
                H√†m: <span class="code">check_device_status_loop()</span><br>
                M·ª•c ƒë√≠ch: ƒê√°nh d·∫•u thi·∫øt b·ªã OFFLINE n·∫øu kh√¥ng nh·∫≠n ƒë∆∞·ª£c heartbeat sau 6s<br>
                Kh·ªüi ƒë·ªông: <span class="code">start_monitoring_service()</span> trong <span class="code">create_app()</span>
            </div>
            
            <div class="step">
                <div class="step-title">üîç Logic ki·ªÉm tra</div>
                <div class="step-desc">
                    ‚Ä¢ So s√°nh <span class="code">datetime.now() - device.last_update_time</span><br>
                    ‚Ä¢ TIMEOUT_SECONDS = 6 gi√¢y<br>
                    ‚Ä¢ N·∫øu > timeout:<br><br>
                    
                    <strong>‚Üí Hosts:</strong><br>
                    &nbsp;&nbsp;‚Ä¢ <span class="code">host.set_status('offline')</span><br>
                    &nbsp;&nbsp;‚Ä¢ <span class="code">socketio.emit('host_updated', host.to_json())</span><br>
                    &nbsp;&nbsp;‚Ä¢ Frontend nh·∫≠n ‚Üí Set group='host-offline'<br><br>
                    
                    <strong>‚Üí Switches:</strong><br>
                    &nbsp;&nbsp;‚Ä¢ <span class="code">switch.set_status('offline')</span><br>
                    &nbsp;&nbsp;‚Ä¢ <span class="code">socketio.emit('switch_updated', switch.to_json())</span><br>
                    &nbsp;&nbsp;‚Ä¢ Frontend nh·∫≠n ‚Üí Set group='switch-offline'<br><br>
                    
                    <strong>‚Üí Links:</strong><br>
                    &nbsp;&nbsp;‚Ä¢ <span class="code">link.set_status('down')</span><br>
                    &nbsp;&nbsp;‚Ä¢ <span class="code">socketio.emit('link_updated', link.to_json())</span><br>
                    &nbsp;&nbsp;‚Ä¢ Frontend nh·∫≠n ‚Üí Set label='DOWN', color=gray, dashed
                </div>
            </div>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">üì° Frontend Event Handlers</div>
                    <div class="step-desc">
                        ‚Ä¢ <strong>host_updated:</strong><br>
                        &nbsp;&nbsp;‚Üí T√¨m node trong graph_data.nodes<br>
                        &nbsp;&nbsp;‚Üí <span class="code">Object.assign(node.details, hostData)</span><br>
                        &nbsp;&nbsp;‚Üí Update group d·ª±a tr√™n status<br><br>
                        
                        ‚Ä¢ <strong>switch_updated:</strong><br>
                        &nbsp;&nbsp;‚Üí T∆∞∆°ng t·ª± host_updated<br><br>
                        
                        ‚Ä¢ <strong>link_updated:</strong><br>
                        &nbsp;&nbsp;‚Üí T√¨m edge trong graph_data.edges<br>
                        &nbsp;&nbsp;‚Üí <span class="code">Object.assign(edge.details, linkData)</span><br>
                        &nbsp;&nbsp;‚Üí Update status, utilization, label<br>
                        &nbsp;&nbsp;‚Üí <strong>Force label='DOWN' n·∫øu status='down' ho·∫∑c throughput=0</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- PHASE 7: ANALYTICS VIEW -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">7</div>
                <div class="phase-title">ANALYTICS DASHBOARD (NEW)</div>
                <div class="phase-time">‚è±Ô∏è On Demand</div>
            </div>
            
            <div class="new-feature">
                <h4>‚ú® T√çNH NƒÇNG M·ªöI: Grafana Integration</h4>
                ‚Ä¢ Component: <span class="code">frontend/src/components/analytics/AnalyticsView.vue</span><br>
                ‚Ä¢ Component: <span class="code">frontend/src/components/analytics/GrafanaPanel.vue</span><br>
                ‚Ä¢ Base URL: <span class="code">VITE_GRAFANA_URL</span> (default: http://localhost:3000)
            </div>
            
            <div class="step">
                <div class="step-title">üìä Dashboard Structure</div>
                <div class="step-desc">
                    ‚Ä¢ <strong>3 Dashboard tabs:</strong><br>
                    1. <strong>Overview:</strong> T·ªïng quan m·∫°ng (CPU + Links + Status Table)<br>
                    2. <strong>Host Performance:</strong> CPU/Memory time series + Status<br>
                    3. <strong>Link Performance:</strong> Throughput + Packet Loss + Table<br><br>
                    
                    ‚Ä¢ Icons: Inline SVG components (HostIcon, LinkIcon, OverviewIcon)<br>
                    ‚Ä¢ Layout: CSS Grid v·ªõi <span class="code">grid-template-columns: repeat(auto-fit, minmax(500px, 1fr))</span>
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üîó Grafana Embed URL Generation</div>
                <div class="step-desc">
                    ‚Ä¢ Function: <span class="code">getEmbedUrl(dashboardUid, panelId)</span><br>
                    ‚Ä¢ Format: <span class="code">{GRAFANA_URL}/d-solo/{uid}?orgId=1&panelId={id}&...</span><br>
                    ‚Ä¢ Parameters:<br>
                    &nbsp;&nbsp;‚Üí from=now-5m, to=now<br>
                    &nbsp;&nbsp;‚Üí theme=dark<br>
                    &nbsp;&nbsp;‚Üí refresh=1s<br>
                    &nbsp;&nbsp;‚Üí var-host_name=All<br><br>
                    
                    ‚Ä¢ <strong>Dashboard UIDs:</strong><br>
                    &nbsp;&nbsp;‚Üí Host Performance: <span class="code">adrnqwx</span><br>
                    &nbsp;&nbsp;‚Üí Link Performance: <span class="code">add97wb</span>
                </div>
            </div>
            
            <div class="changed">
                <strong>üî• FIX: Grafana Iframe Loading Issues</strong><br>
                ‚Ä¢ <strong>V·∫•n ƒë·ªÅ:</strong> Iframe b·ªã block ho·∫∑c kh√¥ng load<br>
                ‚Ä¢ <strong>Solution:</strong><br>
                1. Docker Compose Environment Variables:<br>
                &nbsp;&nbsp;‚Üí <span class="code">GF_SECURITY_ALLOW_EMBEDDING=true</span><br>
                &nbsp;&nbsp;‚Üí <span class="code">GF_SECURITY_CONTENT_SECURITY_POLICY=false</span><br>
                &nbsp;&nbsp;‚Üí <span class="code">GF_AUTH_ANONYMOUS_ENABLED=true</span><br>
                &nbsp;&nbsp;‚Üí <span class="code">GF_AUTH_ANONYMOUS_ORG_ROLE=Viewer</span><br><br>
                
                2. GrafanaPanel.vue Structure:<br>
                &nbsp;&nbsp;‚Üí Iframe LU√îN t·ªìn t·∫°i (kh√¥ng d√πng v-if)<br>
                &nbsp;&nbsp;‚Üí Loading overlay ch·ªìng L√äN iframe (z-index:10)<br>
                &nbsp;&nbsp;‚Üí Position relative container + absolute iframe<br>
                &nbsp;&nbsp;‚Üí Force reload b·∫±ng <span class="code">:key="iframeKey"</span>
            </div>
        </div>

        <!-- SUMMARY TABLE -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">üìä</div>
                <div class="phase-title">T·ªîNG QUAN T·∫¶N SU·∫§T HO·∫†T ƒê·ªòNG (C·∫¨P NH·∫¨T)</div>
            </div>
            
            <table class="frequency-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>H√†nh ƒë·ªông</th>
                        <th>T·∫ßn su·∫•t</th>
                        <th>C·∫£i ti·∫øn</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Traffic Generator</strong></td>
                        <td>T·∫°o iPerf traffic ng·∫´u nhi√™n</td>
                        <td class="highlight">0.5-2s/l·∫ßn</td>
                        <td>
                            ‚Ä¢ Validation: Check shell & waiting state<br>
                            ‚Ä¢ Lock protection: <span class="code">with src.lock</span><br>
                            ‚Ä¢ Try-catch bao quanh m·ªçi cmd
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Latency Thread</strong></td>
                        <td>Random sampling ping</td>
                        <td class="highlight">1s (10 c·∫∑p)</td>
                        <td>
                            ‚Ä¢ Random ch·ªçn 10 c·∫∑p thay v√¨ duy·ªát h·∫øt<br>
                            ‚Ä¢ Timeout: -W 0.1s<br>
                            ‚Ä¢ Lock protection khi ping<br>
                            ‚Ä¢ Parse jitter t·ª´ mdev
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Mininet Main Loop</strong></td>
                        <td>Thu th·∫≠p CPU, Memory, Links</td>
                        <td class="highlight">1s (real interval)</td>
                        <td>
                            ‚Ä¢ Warm-up 3s tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu<br>
                            ‚Ä¢ T√≠nh real_interval v·ªõi monotonic()<br>
                            ‚Ä¢ Log: Total BW + Avg CPU
                        </td>
                    </tr>
                    <tr>
                        <td><strong>CPU Collection</strong></td>
                        <td>Cgroups-based measurement</td>
                        <td class="highlight">1s</td>
                        <td>
                            ‚Ä¢ ƒê·ªçc cpuacct.usage (nanoseconds)<br>
                            ‚Ä¢ T√≠nh delta usage<br>
                            ‚Ä¢ Fallback: ps -p {pid}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Link Collection</strong></td>
                        <td>EMA smoothing</td>
                        <td class="highlight">1s</td>
                        <td>
                            ‚Ä¢ ALPHA=0.7 (70% new, 30% old)<br>
                            ‚Ä¢ Timeout 0.2s protection<br>
                            ‚Ä¢ Lock protection
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Switch Stats</strong></td>
                        <td>ovs-ofctl dump-ports</td>
                        <td class="highlight">5s (cached)</td>
                        <td>
                            ‚Ä¢ Cache result for 5s<br>
                            ‚Ä¢ Full metadata: switch_name, port_name
                        </td>
                    </tr>
                    <tr>
                        <td><strong>WebSocket Transmission</strong></td>
                        <td>G·ª≠i telemetry_batch</td>
                        <td class="highlight">1s</td>
                        <td>
                            ‚Ä¢ Reconnection: enabled<br>
                            ‚Ä¢ Max attempts: infinite<br>
                            ‚Ä¢ Delay: 1-5s
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Backend Processing</strong></td>
                        <td>Update Digital Twin + Broadcast</td>
                        <td class="highlight">1s</td>
                        <td>
                            ‚Ä¢ Lock protection: data_lock<br>
                            ‚Ä¢ Status change detection<br>
                            ‚Ä¢ Instant broadcast on change
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Frontend Re-render</strong></td>
                        <td>C·∫≠p nh·∫≠t vis-network</td>
                        <td class="highlight">1s</td>
                        <td>
                            ‚Ä¢ Watch graphDataString<br>
                            ‚Ä¢ Process nodes/edges<br>
                            ‚Ä¢ Update without reload
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Reaper Thread</strong></td>
                        <td>Ki·ªÉm tra timeout</td>
                        <td class="highlight">3s</td>
                        <td>
                            ‚Ä¢ Timeout: 6s<br>
                            ‚Ä¢ Broadcast on status change<br>
                            ‚Ä¢ Handle hosts, switches, links
                        </td>
                    </tr>
                    <tr>
                        <td><strong>InfluxDB Writer</strong></td>
                        <td>Background queue worker</td>
                        <td class="highlight">Batch 500 / 1s</td>
                        <td>
                            ‚Ä¢ Queue maxsize: 100<br>
                            ‚Ä¢ Timeout: 0.1s (drop if full)<br>
                            ‚Ä¢ Error tracking: sleep 10s after 10 errors<br>
                            ‚Ä¢ Queue size monitoring
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- KEY IMPROVEMENTS -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">üöÄ</div>
                <div class="phase-title">C√ÅC C·∫¢I TI·∫æN CH√çNH</div>
            </div>
            
            <div class="success">
                <strong>1. Thread Safety & Concurrency:</strong><br>
                ‚Ä¢ Threading.Lock cho m·ªói host (tr√°nh race condition)<br>
                ‚Ä¢ data_lock cho Digital Twin updates<br>
                ‚Ä¢ _cache_lock cho latency metrics<br>
                ‚Ä¢ Queue-based InfluxDB writer (non-blocking)
            </div>
            
            <div class="success">
                <strong>2. Performance Optimization:</strong><br>
                ‚Ä¢ EMA smoothing cho link throughput (gi·∫£m noise)<br>
                ‚Ä¢ Random sampling cho latency (thay v√¨ full mesh)<br>
                ‚Ä¢ Switch stats caching (5s interval)<br>
                ‚Ä¢ Background measurement threads<br>
                ‚Ä¢ Real interval calculation (thay v√¨ sleep c·ªë ƒë·ªãnh)
            </div>
            
            <div class="success">
                <strong>3. Robustness & Error Handling:</strong><br>
                ‚Ä¢ Timeout protection: 0.1-0.2s cho network operations<br>
                ‚Ä¢ Shell validation tr∆∞·ªõc khi th·ª±c thi cmd<br>
                ‚Ä¢ Queue overflow protection (drop data thay v√¨ crash)<br>
                ‚Ä¢ Consecutive error tracking (sleep khi qu√° nhi·ªÅu l·ªói)<br>
                ‚Ä¢ Try-catch bao quanh m·ªçi critical operations
            </div>
            
            <div class="success">
                <strong>4. UI/UX Improvements:</strong><br>
                ‚Ä¢ Multi-view support (Live Monitoring + Analytics)<br>
                ‚Ä¢ Grafana integration v·ªõi 3 dashboards<br>
                ‚Ä¢ Real-time status detection v√† broadcast<br>
                ‚Ä¢ Node group auto-correction (fix misidentification)<br>
                ‚Ä¢ Link status priorities (down > high-load > warning > up)
            </div>
            
            <div class="success">
                <strong>5. Data Accuracy:</strong><br>
                ‚Ä¢ Cgroups-based CPU measurement (ch√≠nh x√°c h∆°n)<br>
                ‚Ä¢ Real memory usage t·ª´ free command<br>
                ‚Ä¢ Jitter measurement t·ª´ ping mdev<br>
                ‚Ä¢ Throughput smoothing v·ªõi EMA<br>
                ‚Ä¢ Status t·ª´ Backend (single source of truth)
            </div>
        </div>

        <!-- CRITICAL PATHS -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">‚ö†Ô∏è</div>
                <div class="phase-title">CRITICAL PATHS & DEPENDENCIES</div>
            </div>
            
            <div class="warning">
                <strong>1. Lock Hierarchy (Tr√°nh Deadlock):</strong><br>
                ‚Ä¢ Host.lock (per-host) ‚Üí data_lock (global) ‚Üí _cache_lock (metrics)<br>
                ‚Ä¢ KH√îNG bao gi·ªù acquire locks theo th·ª© t·ª± ng∆∞·ª£c l·∫°i<br>
                ‚Ä¢ Always release locks trong finally block
            </div>
            
            <div class="warning">
                <strong>2. WebSocket Event Order:</strong><br>
                ‚Ä¢ <span class="code">initial_state</span> PH·∫¢I ƒë∆∞·ª£c x·ª≠ l√Ω tr∆∞·ªõc batch_update<br>
                ‚Ä¢ Frontend PH·∫¢I ki·ªÉm tra networkData !== null<br>
                ‚Ä¢ Status updates PH·∫¢I ƒë∆∞·ª£c broadcast ri√™ng (host_updated, link_updated)
            </div>
            
            <div class="warning">
                <strong>3. Timing Dependencies:</strong><br>
                ‚Ä¢ Warm-up 3s sau khi start traffic<br>
                ‚Ä¢ Reaper timeout (6s) > batch interval (1s)<br>
                ‚Ä¢ Queue timeout (0.1s) < batch interval (1s)<br>
                ‚Ä¢ Switch cache (5s) > batch interval (1s)
            </div>
            
            <div class="warning">
                <strong>4. Data Consistency:</strong><br>
                ‚Ä¢ Status LU√îN l·∫•y t·ª´ Backend (kh√¥ng t√≠nh l·∫°i ·ªü Frontend)<br>
                ‚Ä¢ Throughput = 0 ‚Üí Force status='down' (override Backend)<br>
                ‚Ä¢ Node group based on ID prefix (kh√¥ng d√πng group c≈©)<br>
                ‚Ä¢ Link status priorities: down > offline > high-load > warning > up
            </div>
        </div>

        <!-- SHUTDOWN PHASE -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">üõë</div>
                <div class="phase-title">K·∫æT TH√öC ·ª®NG D·ª§NG (Ctrl+C)</div>
            </div>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">1. Stop Background Threads</div>
                    <div class="step-desc">
                        ‚Ä¢ <span class="code">network_stats.stop_background_measurement()</span><br>
                        ‚Ä¢ Set <span class="code">_stop_event</span><br>
                        ‚Ä¢ Join thread v·ªõi timeout 2s
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">2. Stop Traffic Generator</div>
                    <div class="step-desc">
                        ‚Ä¢ <span class="code">traffic_gen.stop()</span><br>
                        ‚Ä¢ Set <span class="code">running=False</span><br>
                        ‚Ä¢ Kill all iperf processes: <span class="code">killall iperf</span>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">3. Disconnect WebSocket</div>
                    <div class="step-desc">
                        ‚Ä¢ <span class="code">socket_client.disconnect()</span><br>
                        ‚Ä¢ Close SocketIO connection gracefully
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">4. Stop Mininet</div>
                    <div class="step-desc">
                        ‚Ä¢ <span class="code">net.stop()</span><br>
                        ‚Ä¢ Clean up OVS switches<br>
                        ‚Ä¢ Remove network namespaces
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="step-title">5. Flush InfluxDB Queue</div>
                    <div class="step-desc">
                        ‚Ä¢ Worker thread t·ª± ƒë·ªông x·ª≠ l√Ω remaining items<br>
                        ‚Ä¢ <span class="code">telemetry_queue.task_done()</span><br>
                        ‚Ä¢ Close InfluxDB client connection
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div style="text-align: center; margin-top: 50px; padding: 30px; background: rgba(0, 247, 247, 0.1); border-radius: 12px;">
            <h2 style="color: #00F7F7; margin-bottom: 15px;">üìö Document Version</h2>
            <p style="font-size: 1.2em; color: #94a3b8;">
                <strong>Updated:</strong> December 2024<br>
                <strong>Status:</strong> Production Ready ‚úÖ<br>
                <strong>Architecture:</strong> 3-tier (Mininet ‚Üí Backend ‚Üí Frontend)<br>
                <strong>Key Technologies:</strong> Flask, SocketIO, Vue.js, vis-network, InfluxDB, Grafana
            </p>
        </div>
    </div>
</body>
</html>